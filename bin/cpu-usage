#!/usr/bin/env python

# TODO make this work on FreeBSD

import argparse
from math import ceil
import subprocess
import sys

parser = argparse.ArgumentParser()
parser.add_argument('--i3', action='store_true')
args = parser.parse_args()

proc = subprocess.Popen(
    "mpstat 2 1 | grep Average: | awk '{ print (100 - $12) }'",
    shell=True,
    stdout=subprocess.PIPE,
    stderr=subprocess.PIPE)
stdout, stderr = proc.communicate()
percent = float(stdout.strip())

# non-i3 mode

if not args.i3:
    print percent
    sys.exit(0)

# i3 mode

rounded = int(ceil(percent))

print '{0: >2}%'.format(rounded)
print ''
if rounded >= 70:
    print '#ff0000'
elif rounded >= 50:
    print '#ffff00'

if rounded >= 90:
    sys.exit(33)

